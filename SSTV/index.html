<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SSTV Encoder (Scottie S1)</title>
    <meta name="description" content="Encode a 320x256 image into SSTV and blast it out of your speakers.">
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>SSTV Encoder (Scottie S1)</h1>
        
        <div class="upload-section">
            <label for="image">Select an image:</label>
            <input type="file" id="image" accept="image/*">
            <p>Image will be resized to 320x256.</p>

            <label for="audioFile">Select an audio:</label>
            <input type="file" id="audioFile" accept="audio/*">
        </div>

        <div class="buttons">
            <button id="play">Play</button>
            <button id="stop" disabled>Stop</button>
            <button id="render">Render</button>
            <button id="decode">Decode SSTV</button>
            <button id="saveFile">Save Audio File</button>
        </div>

        <canvas id="preview" width="320" height="256"></canvas>
        <canvas id="decoded" width="320" height="256"></canvas>

        <audio id="audioPlayer" controls></audio>

        <footer>
            <p><a href="https://a1ex-13.github.io/me/1">üßî About Me</a></p>
            <p><a href="https://a1ex-13.github.io/KrenSens/Kren_Tokenomics.html">üí™üòÑüåç Kren MEME Tokenomics</a></p>
            <p><a href="https://a1ex-13.github.io">üö™ Home</a></p>
            <p><a href="https://a1ex-13.github.io/SSTV/README.md"> [info]</a></p>
            <p>2.10.25 &copy; A1ex-13</p>
        </footer>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="index.js"></script> <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∞—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ -->
    <script type="module" src="Render.js"></script> <!-- –ú–æ–¥—É–ª—å –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∑–≤—É–∫–∞ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
    <script src="index_decode.js"></script> <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è SSTV -->

    <script>
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        document.getElementById('image').addEventListener('change', handleImageUpload);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const img = new Image();
            const reader = new FileReader();

            reader.onload = function(e) {
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);

            img.onload = function() {
                const canvas = document.getElementById('preview');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                processImageData(imageData);
            };
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–≤—É–∫–æ–≤–æ–π –≤–æ–ª–Ω—ã
        function processImageData(imageData) {
            // –°–æ–∑–¥–∞–µ–º AudioContext
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä Tone
            const tone = new Tone(audioContext);

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∑–≤—É–∫–æ–≤—É—é –≤–æ–ª–Ω—É
            writeImageToTone(imageData, tone);

            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
            document.getElementById('saveFile').onclick = function() {
                tone.saveToFile(audioContext);
            };
        }
    </script>
</body>
</html>

